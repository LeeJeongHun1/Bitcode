<style>
body {
  margin: 0px;
  padding: 0px;
}
#chatBody{
  width: 330px;
  background: white;
  border-radius: 5px;
  overflow: hidden;
  scroll: hidden;
  box-sizing: border-box;
}
#chatBox{
  width: 330px;
  background: white;
  border-radius: 5px;
  overflow: hidden;
  box-sizing: border-box;
  scroll-x: hidden;
  scroll-y: auto;
}
.bottom-bar{
  bottom: 10px;
  color: black;
  position: absolute;
  position: fixed;
}
#msg{
  width: 230px;
  height: 30px;
}
/* 말풍선 */
blockquote {
  margin: 0 auto;
}
p {
  margin: 0 0 0.5em;
  margin-top: 10px;
  border-radius: 1em;
  padding: 0.5em 1em;
  background: #e5e5ea;
  max-width: 75%;
  clear: both;
  position: relative;
}
p.them {
  float: left;
  margin-left: 10px;
}
p.them::after {
  content: "";
  position: absolute;
  left: -0.5em;
  bottom: 0;
  width: 0.5em;
  height: 1em;
  border-right: 0.5em solid #e5e5ea;
  border-bottom-right-radius: 1em 0.5em;
}
p.me {
  float: right;
  margin-right: 10px;
  background-color: #1289fe;
  color: white;
}
p.me::after {
  content: "";
  position: absolute;
  right: -0.5em;
  bottom: 0;
  width: 0.5em;
  height: 1em;
  border-left: 0.5em solid #1289fe;
  border-bottom-left-radius: 1em 0.5em;
}

</style>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://192.168.0.104:10001/socket.io/socket.io.js"></script>

<blockquote class="chat" id="chatBody">
	<!-- 대화창 -->
	<div id="chatBox"></div>
	
	<!-- 메시지 입력창 -->
	<div class="bottom-bar">
		<input type="text" id="message" />
		<input type="button" value="메세지 전송" id="msgBtn"/>
	</div>
</blockquote>

<script>

// 소켓서버에 접속
var socket = io.connect();
// var socket = io.connect("http://192.168.0.179:10001");

// msg 등록
   socket.on("msg", function (data) {
   console.dir(data);
   if(sender.match(data.sender)){
	   $("#chatBox").before("<p class='me'>" + data.sender + " : " + data.msg + "</p>");
   } else{
	   $("#chatBody").before("<p class='them'>" + data.sender + " : " + data.msg + "</p>");
	   
   }
   //$("#chatBody").before(data.sender + " : " + data.msg + "<br>");
   
   
   
   $(document).scrollTop($(document).height());
   });
 
   $("[type=button]").click(function () {
   // id가 msg 인 텍스트 창에 입력된 데이터를 소켓서버에 전송
	console.log("서버로 전송함");
	// msg 호출
     	socket.emit("msg", {roomId: roomId, sender: sender, msg: $("#message").val()});
   });

// 룸번호로 조인
socket.emit('join:room', {roomId: roomId});
   
   // 서버에서 전송받은 방번호와 닉네임
window.addEventListener("message", receiveMessage, false);
var sender = '';
var roomId = '';
var msg = '';
function receiveMessage(event) {
	var obj = JSON.parse(event.data);
	// 채팅 보내는 사람의 닉네임
	sender = obj.sender;
	// 방번호
	roomId = obj.roomId;
	// 메시지
	msg = obj.msg;
	
	// 방번호로 룸 조인
   	socket.emit("joinroom", {roomId: roomId});
}
	
</script>
